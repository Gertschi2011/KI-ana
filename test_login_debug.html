<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Login Debug - KI_ana</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
    input { width: 100%; padding: 10px; margin: 10px 0; font-size: 16px; }
    button { padding: 10px 20px; font-size: 16px; }
    .result { margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 5px; white-space: pre-wrap; }
    .error { background: #fee; }
    .success { background: #efe; }
  </style>
</head>
<body>
  <h1>üîç Login Debug Tool</h1>
  
  <form id="loginForm">
    <label>
      Username:
      <input type="text" id="username" value="gerald" required>
    </label>
    
    <label>
      Password:
      <input type="password" id="password" required>
    </label>
    
    <button type="submit">Test Login</button>
  </form>
  
  <div id="result" class="result" style="display:none"></div>
  
  <script>
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const resultDiv = document.getElementById('result');
      
      // Show what we're sending
      const payload = { username, password, remember: true };
      const payloadStr = JSON.stringify(payload);
      
      resultDiv.style.display = 'block';
      resultDiv.className = 'result';
      resultDiv.textContent = 'üîÑ Sending...\n\n' + 
        'Payload:\n' + payloadStr + '\n\n' +
        'Password length: ' + password.length + ' chars\n' +
        'Password bytes: ' + Array.from(password).map(c => c.charCodeAt(0)).join(', ');
      
      try {
        const response = await fetch('/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: payloadStr
        });
        
        const data = await response.json().catch(() => ({}));
        
        if (response.ok && data.token) {
          resultDiv.className = 'result success';
          resultDiv.textContent = '‚úÖ LOGIN SUCCESSFUL!\n\n' +
            'Response:\n' + JSON.stringify(data, null, 2);
        } else {
          resultDiv.className = 'result error';
          resultDiv.textContent = '‚ùå LOGIN FAILED\n\n' +
            'Status: ' + response.status + '\n' +
            'Response:\n' + JSON.stringify(data, null, 2);
        }
      } catch (err) {
        resultDiv.className = 'result error';
        resultDiv.textContent = '‚ùå NETWORK ERROR\n\n' + err.message;
      }
    });
  </script>
</body>
</html>
